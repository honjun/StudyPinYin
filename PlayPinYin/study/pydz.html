<html>
  <head>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: 'Microsoft YaHei';
      }
      .root{
        display: -webkit-flex;
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
      }    
      .header {
        width: 100%;
        flex: 1;
        /*background-color: #39c;*/
      }
      .container {
        width: 100%;
        flex: 60;
        box-sizing: border-box;
      }
      .pinyin {
        position: relative;
        top: 18%;
        margin: 0 auto;
        width: 1000px;
        height: 300px;
        text-align: center;
        font-size: 200px;
        letter-spacing:100px;
        -webkit-animation-name: fadeIn;
        -webkit-animation-duration: .3s;
        -webkit-animation-delay: 0s;
      }
      .footer {
        width: 100%;
        flex: 1;
        bottom: 0;
        /*background-color: #f00;*/
      }
      .lowerChar, .upperChar{
        display: inline-block;
        letter-spacing:5px;
      }
      .lowerChar + .upperChar{
        margin-left: 50px;
      }
      .button_paly {
        position: fixed;
        bottom: 10px;
        left: 10px;
        width: 100px;
        height: 100px;
        background-image: url('./play.jpg');
        background-size: 100%;
      }
      .button_pause {
        position: fixed;
        bottom: 10px;
        left: 10px;
        width: 100px;
        height: 100px;
        background-image: url('./pause.jpg');
        background-size: 100%;
      }
      .button_sound {
        position: fixed;
        bottom: 10px;
        right: 10px;
        width: 100px;
        height: 100px;
        background-image: url('./button_sound.jpg');
        background-repeat: no-repeat;
        background-size: 100% 100%;
      }
      @-webkit-keyframes fadeIn {
        0% {
          opacity: 0; /*初始状态 透明度为0*/
        }
        50% {
          opacity: 0.5; /*中间状态 透明度为0*/
        }
        100% {
          opacity: 1; /*结尾状态 透明度为1*/
        }
      }
    </style>
  </head>
  <body>
    <div class="root">
      <div class="header"></div>
      <div class="container">
        <div class="pinyin">
          
        </div>
      </div>
      <div class="footer">
        <div class="button_sound"></div>
        <div id="player" class="button_pause"></div>
      </div>
    </div>
    <div class="sounds"></div>
  </body>
  <script src="./jquery.min.js"></script>
  <script>
    let lastNum = 0;
    let random = 0;
    let index = 0; //打字进度
    let timer = null;
    let audio = null;
    let charArr = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z']; //26
    let charsArr = ['ai','an','ang','ao','ci','chi','ei','en','eng','er','ian','ie','in','ing','iu','ong','ou','si','shi','ue','ui','un','vn','wu','yan','ye','yi','yin','ying','yu','yuan','yue','yun','zi','zhi']  //35
    let pinyin = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','ai','an','ang','ao','ci','chi','ei','en','eng','er','ian','ie','in','ing','iu','ong','ou','si','shi','ue','ui','un','vn','wu','yan','ye','yi','yin','ying','yu','yuan','yue','yun','zi','zhi'];
    function init(){
      let sounds = $('.sounds');
      let length = pinyin.length;
      for (let i = 0; i < length; i++) {
        sounds.append('<audio src="./sounds/' + pinyin[i] + '.mp3" id="' + pinyin[i] + '" preload="auto" style="display:none;"></audio>')
      }
    }
    init();
  </script>
  <script>
    $(function() {
      let $pinyin = $('.pinyin');
      create()
      function getRandom(n) {
        return Math.floor(Math.random()*n)
      }
      $('#player').click(function() {
        $(this).toggleClass('button_paly')
        $(this).toggleClass('button_pause')
        if ($(this).hasClass('button_paly')) {
          timer = window.setInterval(create, 2000);
          timer;
        } else {
          window.clearInterval(timer);
        }
      });
      $('.button_sound').click(function() {
        audio.play();
      })
      function create() {
        random = getRandom(61);
        while (random === lastNum) {
          random = getRandom(61);
        }
        // random = lastNum++;
        $pinyin.html('');
        let pinyinLength = pinyin[random].length;
        let lowerChar = '';
        let upperChar = '';
        for (let i = 0; i < pinyinLength; i++) {
          lowerChar += '<div class="lowerChar" id="lowerChar' + i + '">' + pinyin[random].charAt(i) + '</div>';
          upperChar += '<div class="UpperChar" id="upperChar' + i + '">' + pinyin[random].charAt(i).toUpperCase() + '</div>';
        }
        let str = lowerChar + upperChar;
        $pinyin.append(str);
        audio = document.getElementById(pinyin[random]);
        audio.play();
        lastNum = random;
      }
      $(document).keyup(function(event) {
        let code = charArr[event.keyCode - 65];
        let pinyinLength = pinyin[random].length;
        if (pinyinLength > 1) {
          if (code === pinyin[random].charAt(index)) {
            $('#lowerChar' + index).css('color','#69a621');
            $('#upperChar' + index).css('color','#69a621');
            if (++index === pinyinLength) {
              index = 0;
              create();
            }
          } else {
            $('#lowerChar' + index).css('color','#ff0000');
            $('#upperChar' + index).css('color','#ff0000');
          }
        }else if (code === pinyin[random]) {
          create();
        }
        
      });  
    })
  </script>
</html>